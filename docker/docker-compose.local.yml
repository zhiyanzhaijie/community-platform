# Docker Compose 本地环境配置
# 
# 使用方法：
#   docker compose -f docker/docker-compose.local.yml up -d

version: '3.8'

services:
  # PostgreSQL 数据库
  postgres:
    image: postgres:16-alpine
    container_name: community_platform_db_local
    restart: unless-stopped
    
    # 端口映射
    ports:
      - "5432:5432"
    
    # 环境变量
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres_local_2024
      POSTGRES_DB: community_platform_local
      POSTGRES_INITDB_ARGS: "-E UTF8"
      TZ: Asia/Shanghai
    
    # 数据持久化
    volumes:
      - postgres_data:/var/lib/postgresql/data
    
    # 健康检查
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
    
    # 资源限制
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M

# 数据卷
volumes:
  postgres_data:
    driver: local
    name: community_platform_postgres_local

# 网络配置
networks:
  default:
    name: community_platform_network_local
